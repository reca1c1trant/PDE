# FNO Baseline V2 Training Configuration - Flow Mixing Equation
#
# V2 improvements:
# Model: Residual skip, Positional embedding, ChannelMLP (PINO-aligned)
# Training: Normalized PDE loss, Progressive weight, Boundary loss
#
# Key difference from Burgers: in_channels=1, out_channels=1

# Model Configuration
model:
  in_channels: 1                       # Flow only has u channel
  out_channels: 1
  width: 64                            # Hidden channel width
  modes: 32                            # Fourier modes to keep
  n_layers: 8                          # Number of FNO blocks

  # Architecture options (PINO-aligned)
  use_positional_embedding: true       # Add (x, y) coordinate grid
  use_channel_mlp: true                # ChannelMLP in FNO blocks
  mlp_expansion: 0.5                   # MLP hidden = width * expansion
  grid_h: 128                          # Grid height for pos embed
  grid_w: 128                          # Grid width for pos embed

# Dataset
dataset:
  path: "./flow_mixing_vtmax0.5_2.0_res128_t1000_n100.h5"
  temporal_length: 8                   # Will load 9 frames (8+1)
  train_ratio: 0.9
  seed: 42
  clips_per_sample: null

# Physics parameters
physics:
  dt: 0.001001001                      # 1/999, time step
  Lx: 1.0                              # Domain size x
  Ly: 1.0                              # Domain size y

# DataLoader
dataloader:
  batch_size: 64
  num_workers: 4
  pin_memory: true

# Training
training:
  max_epochs: 20
  warmup_steps: 200                    # LR warmup
  pde_warmup_steps: 1000               # PDE weight warmup (0 → lambda_pde)
  learning_rate: 1.0e-3
  min_lr: 1.0e-5
  weight_decay: 1.0e-4
  betas: [0.9, 0.999]
  grad_clip: 1.0

  # Loss weights
  lambda_rmse: 1.0                     # RMSE loss weight (constant)
  lambda_pde: 1.0                      # PDE loss weight (progressive: 0 → 1.0)
  lambda_bc: 1.0                       # Boundary loss weight

  mixed_precision: "bf16"
  gradient_accumulation_steps: 1
  eval_interval: 100
  early_stopping_patience: 300

# Logging
logging:
  project: "pde-fno-baseline-v2"
  entity: "reca1c1trant-ntu"
  save_dir: "./checkpoints_fno_baseline_flow_v2"
  log_interval: 10
